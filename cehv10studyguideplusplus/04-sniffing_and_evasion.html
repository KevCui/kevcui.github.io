
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>04-Sniffing and Evasion Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-advanced-emoji/emoji-website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="05-system_hacking.html" />
    
    
    <link rel="prev" href="03-scanning_and_enumeration.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    CEHv10 Study Guide++
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="01-essential_knowledge.html">
            
                <a href="01-essential_knowledge.html">
            
                    
                    01-Essential Knowledge
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="02-reconnaissance_and_footprinting.html">
            
                <a href="02-reconnaissance_and_footprinting.html">
            
                    
                    02-Reconnaissance and Footprinting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="03-scanning_and_enumeration.html">
            
                <a href="03-scanning_and_enumeration.html">
            
                    
                    03-Scanning and Enumeration
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5" data-path="04-sniffing_and_evasion.html">
            
                <a href="04-sniffing_and_evasion.html">
            
                    
                    04-Sniffing and Evasion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="05-system_hacking.html">
            
                <a href="05-system_hacking.html">
            
                    
                    05-System Hacking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="06-web_server_and_web_application_hacking.html">
            
                <a href="06-web_server_and_web_application_hacking.html">
            
                    
                    06-Web Server and Web Application Hacking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="07-wireless_network_hacking.html">
            
                <a href="07-wireless_network_hacking.html">
            
                    
                    07-Wireless Network Hacking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="08-mobile_and_iot_hacking.html">
            
                <a href="08-mobile_and_iot_hacking.html">
            
                    
                    08-Mobile and IoT Hacking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="09-security_in_cloud_computing.html">
            
                <a href="09-security_in_cloud_computing.html">
            
                    
                    09-Security in Cloud Computing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="10-malware_and_other_attacks.html">
            
                <a href="10-malware_and_other_attacks.html">
            
                    
                    10-Malware and Other Attacks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="11-cryptography.html">
            
                <a href="11-cryptography.html">
            
                    
                    11-Cryptography
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="12-social_engineering.html">
            
                <a href="12-social_engineering.html">
            
                    
                    12-Social Engineering
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="13-pen_testing.html">
            
                <a href="13-pen_testing.html">
            
                    
                    13-Pen Testing
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >04-Sniffing and Evasion</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="04-sniffing-and-evasion">04-Sniffing and Evasion</h1>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="04-sniffing_and_evasion.html#sniffing-and-evasion">Sniffing and Evasion</a><ul>
<li><a href="04-sniffing_and_evasion.html#sniffing">Sniffing</a><ul>
<li><a href="04-sniffing_and_evasion.html#basic-knowledge">Basic Knowledge</a><ul>
<li><a href="04-sniffing_and_evasion.html#nic-network-interface-card">NIC (Network Interface Card)</a></li>
<li><a href="04-sniffing_and_evasion.html#mac-media-access-control">MAC (Media Access Control)</a></li>
<li><a href="04-sniffing_and_evasion.html#arp-address-resolution-protocol">ARP (Address Resolution Protocol)</a></li>
<li><a href="04-sniffing_and_evasion.html#ipv6">IPv6</a></li>
<li><a href="04-sniffing_and_evasion.html#protocols-susceptible">Protocols Susceptible</a></li>
</ul>
</li>
<li><a href="04-sniffing_and_evasion.html#span-port-switched-port-analyzer">SPAN port (Switched Port Analyzer)</a></li>
<li><a href="04-sniffing_and_evasion.html#wiretappingtelephone-tapping">Wiretapping/Telephone tapping</a></li>
<li><a href="04-sniffing_and_evasion.html#mac-flooding">MAC Flooding</a></li>
<li><a href="04-sniffing_and_evasion.html#switch-port-stealing">Switch port stealing</a></li>
<li><a href="04-sniffing_and_evasion.html#dhcp-starvation-dynamic-host-configuration-protocol">DHCP Starvation (Dynamic Host Configuration Protocol)</a></li>
<li><a href="04-sniffing_and_evasion.html#arp-poisoning">ARP Poisoning</a></li>
<li><a href="04-sniffing_and_evasion.html#stp-spanning-tree-protocol-attack">STP (Spanning Tree Protocol) attack</a></li>
<li><a href="04-sniffing_and_evasion.html#spoofing">Spoofing</a></li>
<li><a href="04-sniffing_and_evasion.html#ip-spoofing-detection-techniques">IP Spoofing Detection Techniques</a></li>
<li><a href="04-sniffing_and_evasion.html#wireshark">Wireshark</a></li>
<li><a href="04-sniffing_and_evasion.html#tcpdump">tcpdump</a></li>
<li><a href="04-sniffing_and_evasion.html#other-sniffing-tools">Other Sniffing Tools</a></li>
</ul>
</li>
<li><a href="04-sniffing_and_evasion.html#evasion">Evasion</a><ul>
<li><a href="04-sniffing_and_evasion.html#ids-intrusion-detection-system">IDS (Intrusion Detection System)</a><ul>
<li><a href="04-sniffing_and_evasion.html#types-of-ids">Types of IDS</a></li>
<li><a href="04-sniffing_and_evasion.html#types-of-alerts">Types of Alerts</a></li>
</ul>
</li>
<li><a href="04-sniffing_and_evasion.html#ips-intrusion-prevention-system">IPS (Intrusion Prevention System)</a><ul>
<li><a href="04-sniffing_and_evasion.html#types-of-ips">Types of IPS</a></li>
</ul>
</li>
<li><a href="04-sniffing_and_evasion.html#firewall">Firewall</a><ul>
<li><a href="04-sniffing_and_evasion.html#firewall-technologies">Firewall Technologies</a></li>
<li><a href="04-sniffing_and_evasion.html#types-of-firewall">Types of Firewall</a></li>
</ul>
</li>
<li><a href="04-sniffing_and_evasion.html#honeypot">Honeypot</a></li>
<li><a href="04-sniffing_and_evasion.html#evasion-techniques">Evasion Techniques</a><ul>
<li><a href="04-sniffing_and_evasion.html#firewall-evasion">Firewall Evasion</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="sniffing-and-evasion">Sniffing and Evasion</h2>
<h3 id="sniffing">Sniffing</h3>
<ul>
<li>Capturing packets as they pass on the wire to review for interesting information</li>
<li>Sniffers operate at OSI Layer 2, upper layers won&apos;t be aware of sniffing because OSI layers are designed independently of each other,</li>
<li><strong>Passive sniffing</strong>: watching network traffic without interaction; only works for same collision domain, like sniffing through a hub</li>
<li><strong>Active sniffing</strong>: using methods to make a switch send traffic to you even though it isn&apos;t destined for your machine, like sniffing through a switch-based network</li>
</ul>
<h4 id="basic-knowledge">Basic Knowledge</h4>
<p><strong>NIC (Network Interface Card)</strong></p>
<ul>
<li>Many wireless NICs have bad support for monitor mode in Windows. Catching general traffic is ok but not controlling packets</li>
<li><strong>Promiscuous mode</strong>: NIC must be in this setting to look at all frames passing on the wire</li>
<li><strong>Collision Domains</strong><ul>
<li>Traffic from your NIC, regardless of mode, can only be seen within the same collision domain</li>
<li>Switch has a collision domain for each port</li>
<li>Hub has one collision domain by default</li>
</ul>
</li>
</ul>
<p><strong>MAC (Media Access Control)</strong></p>
<ul>
<li>Physical or burned-in address</li>
<li>Assigned to NIC for communications at the Data Link layer</li>
<li>48 bits long, displayed as 12 hex characters separated by colons<ul>
<li>First half of address is the <strong>organizationally unique identifier</strong>, identifying manufacturer</li>
<li>Second half ensures no two cards on a subnet will have the same address</li>
</ul>
</li>
</ul>
<p><strong>ARP (Address Resolution Protocol)</strong></p>
<ul>
<li>Resolves IP address to a MAC address</li>
<li>Sending a request packet to all the network elements, asking for the MAC address from a specific IP</li>
<li>Working on a broadcast basis, both requests and replies are broadcast to everyone</li>
<li>Broadcast destination MAC address: <code>FF:FF:FF:FF:FF:FF</code></li>
<li>Packets are <code>ARP_REQUEST</code> and <code>ARP_REPLY</code></li>
<li>Stateless, each computer maintains its own ARP cache, which can be poisoned</li>
<li>ARP command<ul>
<li>Display current ARP cache: <code>arp -a</code></li>
<li>Clear ARP cache: <code>arp -d *</code></li>
</ul>
</li>
</ul>
<p><strong>IPv6</strong></p>
<ul>
<li>128-bit address (0000:0000:0000:0000:0000:0000:0000:0000 4x8+7=39 digits), 8 groups of 4 hexadecimal digits</li>
<li>Sections with all 0s are shorted to nothing, just having start and end colons</li>
<li>Double colon can be used only once</li>
<li>Loopback address is <code>::1</code></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">IPv6 Address Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Unicast</td>
<td style="text-align:left">Addressed and intended for one host interface</td>
</tr>
<tr>
<td style="text-align:left">Multicast</td>
<td style="text-align:left">Addressed for multiple host interfaces</td>
</tr>
<tr>
<td style="text-align:left">Anycast</td>
<td style="text-align:left">Large number of hosts can receive; nearest host opens</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left">IPv6 Scopes</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Link local</td>
<td style="text-align:left">Applies only to hosts on the same subnet (Address block fe80::/10)</td>
</tr>
<tr>
<td style="text-align:left">Site local</td>
<td style="text-align:left">Applies to hosts within the same organization (Address block fec0::/10)</td>
</tr>
<tr>
<td style="text-align:left">Global</td>
<td style="text-align:left">Includes everything</td>
</tr>
</tbody>
</table>
<ul>
<li>Scope applies for multicast and anycast</li>
<li>Traditional network scanning is <strong>computationally less feasible</strong></li>
</ul>
<p><strong>Protocols Susceptible</strong></p>
<ul>
<li>SMTP is sent in plain text and is viewable over the wire, until SMTPv3 which limits the information you can get, but you can still see it</li>
<li>SNMP community string, like user id or password</li>
<li>FTP, TFTP, IMAP, POP3, NNTP (Network News Transfer Protocol) and HTTP all send over clear text data</li>
<li>TCP shows sequence numbers, usable in session hijacking</li>
<li>TCP and UCP show open ports</li>
<li>IP shows source and destination addresses</li>
<li>Telnet and Rlogin show keystrokes including user names and passwords sent in cleartext</li>
</ul>
<h4 id="span-port-switched-port-analyzer">SPAN port (Switched Port Analyzer)</h4>
<ul>
<li>Also known as <strong>Port Mirroring</strong></li>
<li>A Cisco switch feature, switch configuration that makes the switch send a copy of all frames from other ports to a specific port</li>
<li>Not all switches have the ability to do this</li>
<li>Only listen</li>
<li>Modern switches sometimes don&apos;t allow SPAN ports to send data</li>
</ul>
<h4 id="wiretappingtelephone-tapping">Wiretapping/Telephone tapping</h4>
<ul>
<li><strong>Active</strong>: alerting or affecting the communication</li>
<li><strong>Passive</strong>: only monitoring or recording the traffic</li>
<li><strong>Lawful interception</strong>: legally intercepting communications between two parties for surveillance</li>
</ul>
<h4 id="mac-flooding">MAC Flooding</h4>
<ul>
<li>Switches either flood or forward data</li>
<li>If a switch doesn&apos;t know what MAC address is on a port, it will flood the data until it finds out</li>
<li>MAC Flooding by sending so many MAC addresses to the CAM table that it can&apos;t keep up</li>
<li>MAC Flooding will often destroy the switch before you get anything useful, doesn&apos;t last long to get noticed</li>
<li>Most modern switches protect against this</li>
<li><strong>CAM Table</strong><ul>
<li>The table on a switch that stores which MAC address is on which port</li>
<li>If table is empty or full, everything is sent to all ports</li>
</ul>
</li>
<li>Tool: Macof</li>
</ul>
<h4 id="switch-port-stealing">Switch port stealing</h4>
<ul>
<li>Using MAC flooding to sniff packets</li>
<li>Flooding switch with forged gratuitous ARP packets with target MAC as source, and attacker&apos;s MAC as destination</li>
<li>A race condition of attacker&apos;s flooded packets and target host packets will occur, switch has to change MAC address binding constantly</li>
</ul>
<h4 id="dhcp-starvation-dynamic-host-configuration-protocol">DHCP Starvation (Dynamic Host Configuration Protocol)</h4>
<ul>
<li>Attempting to exhaust all available addresses from the server, denial-of-service attack</li>
<li>Attacker sends so many requests that the address space allocated is exhausted</li>
<li>DHCPv4 packets: DHCPDISCOVER, DHCPOFFER, DHCPREQUEST, DHCPACK</li>
<li>DHCPv6 packets: Solicit, Advertise, Request (Confirm, Renew, Rebind), Reply</li>
<li><strong>DHCP Steps</strong><ol>
<li>Client sends DHCPDISCOVER</li>
<li>Server responds with DHCPOFFER</li>
<li>Client sends request for IP with DHCPREQUEST</li>
<li>Server sends address and config via DHCPACK</li>
</ol>
</li>
<li>Tool: Yersinia</li>
<li><strong>Rogue DHCP Server Attack</strong>: setup to offer addresses instead of real server. Can be combined with starvation to real server</li>
<li>Countermeasures<ul>
<li>To counter DHCP starvation, ussing port security to limit max. number of MAC addresses on switch</li>
<li>To counter rogue DHCP server attack, configuring DHCP snooping: <code>ip dhcp snooping</code></li>
</ul>
</li>
</ul>
<h4 id="arp-poisoning">ARP Poisoning</h4>
<ul>
<li>Also called <strong>ARP spoofing</strong> or <strong>gratuitous ARP responses</strong></li>
<li>Using special packet to update ARP cache even without a request, used to poison cache on other machines</li>
<li>Changing the cache of machines so that packets are sent to the attacker instead of the intended target</li>
<li>Can trigger alerts because of the constant need to keep updating the ARP cache of machines</li>
<li><strong>Countermeasures</strong><ul>
<li>Permanently adding Default gateway MAC into each machine&apos;s cache</li>
<li>Using Dynamic ARP Inspection (DAI), DHCP snooping database to prevent MITM</li>
<li>Using XArp to detect ARP attacks</li>
</ul>
</li>
<li>Tools<ul>
<li>Cain and Abel</li>
<li>Ufasoft Snif</li>
<li>dsniff</li>
</ul>
</li>
</ul>
<h4 id="stp-spanning-tree-protocol-attack">STP (Spanning Tree Protocol) attack</h4>
<ul>
<li>Attacker has access to switch ports that are able to become trunk ports, then introduce a rogue switch spanning tree priority into the network</li>
<li>Countermeasure: loop protection</li>
</ul>
<h4 id="spoofing">Spoofing</h4>
<ul>
<li><strong>MAC Spoofing</strong><ul>
<li>An address-based authentication attack, changes your MAC address. Benefit is CAM table uses most recent address</li>
<li>Making switch send all packets to your address instead of the intended one until the CAM table is updated with the real address again</li>
<li>Port security allows traffic from a specific MAC address to enter to a port</li>
<li>Port security can slow this down, but doesn&apos;t always stop it</li>
<li>A security feature on switches that allows an administrator to manually assign MAC addresses to a specific port</li>
<li>Spoofing Tool: Technitium MAC Address Changer</li>
<li><strong>Countermeasures</strong><ul>
<li>DHCP Snooping Binding Table: filters untrusted DHCP messages</li>
<li>Dynamic ARP Inspection</li>
<li>IP Source Guard: security feature in switch that restricts IP traffic on untrusted Layer 2 ports by filtering traffic based on DHCP snooping binding database</li>
<li>Encryption: encrypting communication between AP and computer</li>
<li>Retrieval of MAC Address: retrieving MAC address from NIC directly instead of from OS</li>
<li>Implementation of IEEE 802.1X suites: Port-based Network Access Control (PNAC), enforces access control when user joins the network</li>
<li>AAA (Authentication, Authorization, Accounting): using AAA server mechanism in order to filter MAC addresses subsequently</li>
</ul>
</li>
</ul>
</li>
<li><strong>IRDP (Internet Router Discovery Protocol) Spoofing</strong><ul>
<li>Attacker sends ICMP Router Discovery Protocol messages advertising a malicious gateway</li>
<li>Passive sniffing, MITM, DoS</li>
<li><strong>Countermeasure</strong>: disables IRDP on hosts</li>
</ul>
</li>
<li><strong>DNS Poisoning/Spoofing</strong><ul>
<li>Changing where machines get their DNS information from, allowing attacker to redirect to malicious websites</li>
<li><strong>DNS Cache Poisoning</strong>: allowing attacker to replace IP address entries for a target site on a given DNS server with IP address of the server he/she controls</li>
<li><strong>DNSSEC</strong>: helping prevent DNS poisoning by encrypting records</li>
</ul>
</li>
</ul>
<h4 id="ip-spoofing-detection-techniques">IP Spoofing Detection Techniques</h4>
<ul>
<li><strong>Direct TTL Probes</strong><ul>
<li>Sending packet to host of suspect spoofed packet that triggers reply and compare TTL with suspect packet</li>
<li>TTL in the reply is not as the same as the packet being checked, it&apos;s a spoofed packet</li>
<li>This technique is successful when the attacker is in a different subnet from that of the victim</li>
</ul>
</li>
<li><strong>IP Identification Number</strong><ul>
<li>Sending probe to host of suspect spoofed traffic that triggers reply and compare the IP ID with suspect traffic</li>
<li>IP IDs are not close in value to the packet being checked, suspect traffic is spoofed</li>
<li>This technique is deemed successful even if the attacker is in the same subnet</li>
</ul>
</li>
<li><strong>TCP Flow Control Method</strong><ul>
<li>Attackers sends spoofed TCP packets, will not receive the target&apos;s SYN-ACK packets</li>
<li>Attackers cannot therefore be responsive to change in the congestion window size</li>
<li>When received traffic continues after a window size is exhausted, most probably the packets are spoofed</li>
</ul>
</li>
</ul>
<h4 id="wireshark">Wireshark</h4>
<ul>
<li>Previously known as Ethereal</li>
<li>Can be used to follow streams of data</li>
<li>Can also filter the packets by specific packet type or specific source address, for example:<ul>
<li>Filter out the noise from ARP, DNS and ICMP requests: <code>! (arp or icmp or dns)</code></li>
<li>Display HTTP GET requests: <code>http.request</code></li>
<li>Display TCP segments that contain the word <em>string</em>: <code>tcp contains string</code></li>
<li>Display telnet packets containing that IP: <code>ip.addr==172.17.15.12 &amp;&amp; tcp.port==23</code></li>
<li>Display TCP requests with ACK flag set: <code>tcp.flags==0x16</code></li>
<li>Display all TCP connections with SYN packets: <code>tcp.flags.syn==1</code></li>
</ul>
</li>
</ul>
<h4 id="tcpdump">tcpdump</h4>
<ul>
<li>Recent version is WinDump (for Windows)</li>
<li><code>tcpdump [flag] [interface]</code></li>
<li>Put the interface in listening mode: <code>tcpdump -i eth1 &lt;ip&gt;</code></li>
<li><code>-n</code> flag to not perform DNS resolution on IP addresses</li>
<li><code>tcptrace</code> can be used to analyze tcpdump file</li>
</ul>
<h4 id="other-sniffing-tools">Other Sniffing Tools</h4>
<ul>
<li>Ettercap: also can be used for MITM attacks, ARP poisoning. Has active and passive sniffing</li>
<li>Snort: usually discussed as an Intrusion Detection application</li>
<li>SteelCentral Packet Analyzer</li>
<li>Capsa Network Analyzer</li>
<li>OmniPeek</li>
<li>Observer Analyzer</li>
<li>Wi.cap. Network Sniffer Pro: mobile network packet sniffer for ROOT ARM droids</li>
<li>Packet Capture: network traffic sniffer app with SSL decryption</li>
</ul>
<h3 id="evasion">Evasion</h3>
<h4 id="ids-intrusion-detection-system">IDS (Intrusion Detection System)</h4>
<ul>
<li>Hardware or software devices that examine streams of packets for malicious behavior</li>
</ul>
<p><strong>Types of IDS</strong></p>
<ul>
<li><strong>Signature based</strong>: comparing packets against a list of known traffic patterns</li>
<li><strong>Anomaly based</strong>: making decisions on alerts based on learned behavior and &quot;normal&quot; patterns</li>
<li><strong>HIDS</strong> (Host-based intrusion detection system): examining specific host-based actions, such as what applications are being used, what files are being accessed and what information resides in the kernel logs</li>
<li><strong>NIDS</strong> (Network-based intrusion detection system): scanning network traffic, do not use host system resources</li>
<li><strong>NBA</strong> (Network behavior analysis): examining network traffic to identify threats that generate unusual traffic flows</li>
<li><p><strong>Snort</strong>: a widely deployed IDS that is open source</p>
<ul>
<li>Runs in three different modes<ul>
<li><strong>Sniffer Mode</strong>: watching packets in real time</li>
<li><strong>Packet Logger Mode</strong>: saving packets to disk for review at a later time</li>
<li><strong>NIDS Mode</strong>: analyzing network traffic against various rule sets</li>
</ul>
</li>
<li><p>Syntax</p>
<ul>
<li><p>Alert about traffic coming not from an external network to the internal one on port 31337:</p>
<pre><code class="lang-text">alert tcp !HOME_NET any -&gt; $HOME_NET 31337 (msg : &quot;BACKDOOR ATTEMPT-Backorifice&quot;)
</code></pre>
</li>
<li><p>Example output:</p>
<pre><code class="lang-text">10/19-14:48:38.543734 0:48:542:2A:67 -&gt; 0:10:B5:3C:34:C4 type:0x800 len:0x5EA
**xxx -&gt; xxx TCP TTL:64 TOS:0x0 ID:18112 IpLen:20 DgmLen:1500 DF**
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Types of Alerts</strong></p>
<ul>
<li><strong>True Positive</strong> (Attack - Alert): activity was an attack, IDS identifies as an attack</li>
<li><strong>False Positive</strong> (No Attack - Alert): activity was acceptable, but IDS identifies as an attack</li>
<li><strong>False Negative</strong> (Attack - No Alert): activity was an attack, but IDS identifies as an acceptable behavior</li>
<li><strong>True Negative</strong> (No Attack - No Alert): activity was acceptable, IDS identifies as an acceptable behavior</li>
</ul>
<h4 id="ips-intrusion-prevention-system">IPS (Intrusion Prevention System)</h4>
<ul>
<li>Identifying malicious activity, logs information about this activity, reports it and attempts to block or stops it</li>
</ul>
<p><strong>Types of IPS</strong></p>
<ul>
<li><strong>NIPS</strong> (Network-based intrusion prevention system): monitoring the entire network for suspicious traffic by analyzing protocol activity</li>
<li><strong>HIPS</strong> (Host-based intrusion prevention system): an installed software package which monitors a single host for suspicious activity by analyzing events occurring within that host</li>
<li><strong>WIPS</strong> (Wireless intrusion prevention system): monitoring a wireless network for suspicious traffic by analyzing wireless networking protocols</li>
</ul>
<h4 id="firewall">Firewall</h4>
<ul>
<li>An appliance within a network protects internal resources from unauthorized access</li>
<li>Only uses rules that <strong>implicitly denies</strong> traffic unless it is allowed</li>
<li>Often uses <strong>network address translation</strong> (NAT) which can apply a one-to-one or one-to-many relationship between external and internal IP addresses</li>
<li><strong>Bastion Host</strong>: hosts on the screened subnet designed to protect internal resources, using the concept &quot;separation of duties&quot;</li>
<li><strong>Screened Subnet</strong>: DMZ, hosts all public-facing servers and services</li>
<li><strong>Private zone</strong>: hosts internal hosts that only respond to requests from within that zone</li>
<li><strong>Multi-homed</strong>: firewall that has 2 or more interfaces</li>
</ul>
<pre><code class="lang-text">- Single Homed Network:

  Enterprice ---------- ISP

- Dual Homed Network:

  Enterprice ========== ISP

- Single Multi-homed Network

             ---------- ISP1
  Enterprice
             ---------- ISP2

- Dual Multi-homed Network

             ========== ISP1
  Enterprice
             ========== ISP2
</code></pre>
<p><strong>Firewall Technologies</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">OSI</th>
<th style="text-align:left">Firewall Technology</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">7</td>
<td style="text-align:left">VPN, Application Proxies</td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td style="text-align:left">VPN</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left">VPN, Circuit-level Gateway</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left">VPN, Packet Filtering</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left">VPN, NAT, Packet Filtering, Stateful Multilayer Inspection</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left">VPN, Packet Filtering</td>
</tr>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">Not Applicable</td>
</tr>
</tbody>
</table>
<p><strong>Types of Firewall</strong></p>
<ul>
<li><strong>Packet-filtering</strong>: only looking at packet headers (IP address, packet type and port number), layer 3 Network</li>
<li><strong>Circuit-level gateway</strong>: checking TCP handshake, does not filer individual packets, firewall that works on layer 5 Session</li>
<li><strong>Application-level gateway</strong>: working like a proxy, allowing specific services in and out, WAF, layer 7 Application</li>
<li><strong>Stateful inspection</strong>: combining above 3 types of firewalls, dynamic packet filtering, firewalls that track the entire status of a connection</li>
</ul>
<h4 id="honeypot">Honeypot</h4>
<ul>
<li>A system setup as a decoy to entice attackers, to research attack methodologies</li>
<li>Should not include too many open services or look too easy to attack</li>
<li><strong>High interaction</strong>: actually running all services and applications and is designed to be completely compromised</li>
<li><strong>Medium interaction</strong>: simulating a real OS, applications and its services</li>
<li><strong>Low interaction</strong>: simulating a number of services and cannot be completely compromised</li>
<li>Examples<ul>
<li>Specter</li>
<li>Honeyd</li>
<li>KFSensor</li>
</ul>
</li>
</ul>
<h4 id="evasion-techniques">Evasion Techniques</h4>
<ul>
<li><strong>Fragmentation</strong>: splitting up packets so that the IDS can&apos;t detect the real intent, <code>nmap -f</code></li>
<li><p><strong>Time-To-Live Attack</strong> (TTL)</p>
<ul>
<li>Each router along a data path decrements TTL by 1</li>
<li>TTL reaches 0, package is dropped</li>
<li>Attacker has a prior knowledge of topology of target network, in order to calculate TTL</li>
<li>Breaking traffic to fragments, eg: Frag 1, Frag 2, Frag 3</li>
<li><p>Sending fragments as below as an exmaple:</p>
<pre><code class="lang-text">Attacker          NIDS             Router    Victim
Frag 1        -&gt;  Frag 1            -&gt;       Frag 1
Frag 2, TTL=1 -&gt;  Frag 1, 2        Dropped   Frag 1, Waiting 2
Frag 3        -&gt;  Frag 1, 2, 3      -&gt;       Frag 1, 3 Waiting 2
                False Reassembly
Real Frag 2   -&gt;  Frag 2            -&gt;       Frag 1, 2, 3, Correct Reassembly
</code></pre>
</li>
</ul>
</li>
<li><strong>Slow down</strong>: faster scanning such as using nmap&apos;s -T5 switch will get you caught. Pros use -T1 switch to get better results</li>
<li><strong>Unicode encoding</strong>: working with web requests - using Unicode characters instead of ascii can sometimes get past</li>
<li><strong>Network flooding</strong>: triggering alerts that aren&apos;t your intended attack so that confuses firewalls/IDS and network admins</li>
<li><strong>Insertion Attack</strong>: confusing IDS by forcing it to read invalid packets</li>
<li><strong>Spoofing</strong>: can only be used when you don&apos;t expect a response back to your machine</li>
<li><strong>Source routing</strong>: specifying the path a packet should take on the network; most systems don&apos;t allow this anymore</li>
<li><strong>IP Address Decoy</strong>: sending packets from your IP as well as multiple other decoys to confuse the IDS/Firewall as to where the attack is really coming from<ul>
<li><code>nmap -D RND:10 x.x.x.x</code></li>
<li><code>nmap -D decoyIP1,decoyIP2....,sourceIP,.... [target]</code></li>
</ul>
</li>
<li><strong>Proxy</strong><ul>
<li>Hiding true identity by filtering through another computer</li>
<li>Also can be used for other purposes such as content blocking evasion, etc</li>
<li><strong>Proxy chains</strong>: chains multiple proxies together<ul>
<li>Proxy Switcher</li>
<li>Proxy Workbench</li>
<li>ProxyChains</li>
</ul>
</li>
</ul>
</li>
<li><strong>Tor</strong><ul>
<li>A specific type of proxy that uses multiple hops to a destination</li>
<li>Endpoints are peer computers</li>
</ul>
</li>
<li><strong>Anonymizers</strong>: hiding identity on HTTP traffic (port 80)</li>
<li>Tools<ul>
<li>Nessus: also a vulnerability scanner</li>
<li>ADMutate: creating scripts not recognizable by signature files</li>
<li>Whisker: session Splicing</li>
</ul>
</li>
</ul>
<p><strong>Firewall Evasion</strong></p>
<ul>
<li><strong>Firewalking</strong>: going through every port on a firewall to determine what is open</li>
<li>Firewall type can be discerned by banner grabbing</li>
<li>The best way around a firewall will always be a compromised internal machine</li>
<li><strong>HTTP tunneling</strong>: crafting port 80 segments to carry a payload for protocols the firewall may have, then on other end (internal machine) to pull the payload out of all those 80 packets</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="03-scanning_and_enumeration.html" class="navigation navigation-prev " aria-label="Previous page: 03-Scanning and Enumeration">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="05-system_hacking.html" class="navigation navigation-next " aria-label="Next page: 05-System Hacking">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"04-Sniffing and Evasion","level":"1.5","depth":1,"next":{"title":"05-System Hacking","level":"1.6","depth":1,"path":"05-system_hacking.md","ref":"05-system_hacking.md","articles":[]},"previous":{"title":"03-Scanning and Enumeration","level":"1.4","depth":1,"path":"03-scanning_and_enumeration.md","ref":"03-scanning_and_enumeration.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["advanced-emoji"],"pluginsConfig":{"advanced-emoji":{"embedEmojis":false},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"04-sniffing_and_evasion.md","mtime":"2020-06-27T08:19:41.665Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-07-05T07:09:45.423Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

